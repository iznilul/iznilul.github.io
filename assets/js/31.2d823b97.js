(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{443:function(t,s,a){"use strict";a.r(s);var e=a(2),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"python-selenium实现自动订舱"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#python-selenium实现自动订舱"}},[t._v("#")]),t._v(" python+selenium实现自动订舱")]),t._v(" "),a("h2",{attrs:{id:"_0x01前言-准备工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x01前言-准备工具"}},[t._v("#")]),t._v(" 0x01前言+准备工具")]),t._v(" "),a("p",[t._v("最近重操旧业想写点爬虫，感受一下刚上大学用python敲出hello world的那段时光")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/iznilul/magicargoSpider",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("浏览器：chrome91.0及其驱动")]),t._v(" "),a("p",[t._v("python3.7+selenium")]),t._v(" "),a("p",[t._v("基于订舱网站 http://www.magicargo.com/#/")]),t._v(" "),a("h2",{attrs:{id:"_0x02-需求流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-需求流程"}},[t._v("#")]),t._v(" 0x02 需求流程")]),t._v(" "),a("p",[t._v("这次的分析是基于登录账户-》站到站查询-》班列订舱-》填写信息-》下单")]),t._v(" "),a("p",[t._v("打开主页")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438557563.png",alt:""}})]),t._v(" "),a("p",[t._v("点击查询可以看到班列信息，点击订舱")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438555181.png",alt:""}})]),t._v(" "),a("p",[t._v("在这个页面填上一些货物信息，下单")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438563499.png",alt:""}})]),t._v(" "),a("p",[t._v("会有一个验证码，验证通过即可下单")]),t._v(" "),a("h2",{attrs:{id:"_0x03-分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x03-分析"}},[t._v("#")]),t._v(" 0x03 分析")]),t._v(" "),a("p",[t._v("根据这个需求决定写一个自动化脚本比较好，所以采用浏览器模拟请求的方式，动态调试方法")]),t._v(" "),a("p",[t._v("首先在桌面上新建立一个chrome快捷方式，然后再硬盘里准备一个空文件夹")]),t._v(" "),a("p",[t._v("打开快捷方式属性，在后面加上")]),t._v(" "),a("p",[t._v('--remote-debugging-port=5003 --user-data-dir="D:\\python\\pySelenium"')]),t._v(" "),a("p",[t._v("标识5003为浏览器的调试端口，可以通过访问这个端口控制浏览器")]),t._v(" "),a("p",[t._v("python代码")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" webdriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ChromeOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_experimental_option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debuggerAddress"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:5003"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#调试方法启动浏览器")]),t._v("\nself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driver "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" webdriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("这样就可以，动态的调试浏览器，不用像以前那样用selenium每次运行都得重启啦")]),t._v(" "),a("h3",{attrs:{id:"登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[t._v("#")]),t._v(" 登录")]),t._v(" "),a("p",[t._v("登录可以设置cookies解决，而且因为是用浏览器请求，只要在第一次登录网站的时候登录一次，浏览器就可以保存cookies到本地")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438558111.png",alt:""}})]),t._v(" "),a("p",[t._v("而且保质期有一个月，一个月内只要再次登录就能继续延长")]),t._v(" "),a("p",[t._v("为了保险起见我还是把cookies的一些函数写上了，只不过没有调用")]),t._v(" "),a("h3",{attrs:{id:"查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[t._v("#")]),t._v(" 查询")]),t._v(" "),a("p",[t._v("这一部分比较简单，定位四个元素模拟填入和点击即可")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438561105.png",alt:""}})]),t._v(" "),a("p",[t._v("需要注意的点是起始地和目的地需要先"),a("strong",[t._v("选中元素-》填入部分字段-》再根据提示选择字段")]),t._v("，源代码中有具体步骤")]),t._v(" "),a("h3",{attrs:{id:"订舱-填写消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#订舱-填写消息"}},[t._v("#")]),t._v(" 订舱&填写消息")]),t._v(" "),a("p",[t._v("点击查询之后回有一个xhr请求耗时比较长需要sleep一会")]),t._v(" "),a("p",[t._v("填写消息时也是最后一个确认checkbox类型需要用js脚本模拟点击")]),t._v(" "),a("p",[t._v("其他都是比较基础的操作，就不一一赘述了")]),t._v(" "),a("h3",{attrs:{id:"下单-滑动验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下单-滑动验证"}},[t._v("#")]),t._v(" 下单&&滑动验证")]),t._v(" "),a("p",[t._v("验证码这里需要仔细分析一下")]),t._v(" "),a("p",[t._v("点击下单之后会弹出一张验证码")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438563499.png",alt:""}})]),t._v(" "),a("p",[t._v("这种滑动验证一般采用的方法是对比两张图片，计算图像左侧到拼图缺口的距离，然后模拟拉取操作")]),t._v(" "),a("h4",{attrs:{id:"坑一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#坑一"}},[t._v("#")]),t._v(" 坑一")]),t._v(" "),a("p",[t._v("首先需要得到两张图片，一张背景图一张有缺口的图")]),t._v(" "),a("p",[t._v("可是发现网页元素上只有这一张缺口图，背景图藏在了network选项卡的静态资源请求记录里")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438564003.png",alt:""}})]),t._v(" "),a("p",[t._v("网页元素缺口可以用截图的方式保存到本地")]),t._v(" "),a("p",[t._v("这张藏在network选项卡里的图片只好先获取chrome performance日志记录，然后再把base64转码存储")]),t._v(" "),a("h4",{attrs:{id:"坑二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#坑二"}},[t._v("#")]),t._v(" 坑二")]),t._v(" "),a("p",[t._v("仔细对比两张图片那张缺口的截图图片似乎有问题，因为它最上面总有一个没截完整的细细白条")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438565463.png",alt:""}})]),t._v(" "),a("p",[t._v("这样两张图片根本不一样，导致无法定位")]),t._v(" "),a("p",[t._v("只好用裁剪的方式修改了一下")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/iznilul/img/1645438567983.png",alt:""}})]),t._v(" "),a("p",[t._v("这样就帅多了")]),t._v(" "),a("p",[t._v("然后俺用网上找来的参考代码，结合pillow图像处理的函数，进行了缺图定位和模拟拉取")]),t._v(" "),a("p",[t._v("模拟滑动之后下单完成")]),t._v(" "),a("h2",{attrs:{id:"_0x04总结-参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x04总结-参考资料"}},[t._v("#")]),t._v(" 0x04总结+参考资料")]),t._v(" "),a("p",[t._v("总之还是一个很水的自动化脚本，后续如果需要的话将继续优化")]),t._v(" "),a("p",[t._v("https://cloud.tencent.com/developer/article/1703946")]),t._v(" "),a("p",[t._v("https://www.cnblogs.com/liuhui0308/p/12091810.html")]),t._v(" "),a("p",[t._v("https://www.aneasystone.com/archives/2018/03/python-selenium-geetest-crack.html")])])}),[],!1,null,null,null);s.default=r.exports}}]);